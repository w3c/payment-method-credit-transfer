<!DOCTYPE html>
<html>
  <head>
    <title>SEPA Credit Transfer</title>
    <meta charset='utf-8'>
    <script src='https://www.w3.org/Tools/respec/respec-w3c-common'
            async class='remove'></script>
    <script class='remove'>
      var respecConfig = {
          shortName:  "payment-method-basic-ct-dd",
          edDraftURI:   "https://w3c.github.io/browser-payment-api/basic-ct-dd-payment.html",
          specStatus: "ED",
          editors: [
                {   name:       "Cyril Vignet",
                    company:    "BPCE" },
								{   name:       "Matt Saxon",
                    company:    "Worldpay" }
          ],
          useExperimentalStyles: true,
          license:      "w3c-software-doc",
          //previousMaturity: "FPWD",
          //previousPublishDate:  "1977-03-15",
          wg:           "Web Payments Working Group",
          wgURI:        "https://www.w3.org/Payments/WG/",
          wgPublicList: "public-payments-wg",
          wgPatentURI:  "https://www.w3.org/2004/01/pp-impl/83744/status",
          issueBase:    "https://github.com/w3c/browser-payment-api/issues/",
          localBiblio:  {
              "PAYMENTARCH": {
                  title:    "Payment Request Architecture"
              ,   href:     "architecture.html"
              ,   authors:  [
                      "Adrian Bateman"
                  ,   "Zach Koch"
                  ,   "Richard Barnes"
                  ]
              ,   status:   "ED"
              },
              "PAYMENTREQUESTAPI": {
                  title:    "Payment Request API"
              ,   href:     "paymentrequest.html"
              ,   authors:  [
                      "Adrian Bateman"
                  ,   "Zach Koch"
                  ,   "Richard Barnes"
                  ]
              ,   status:   "ED"
              },
              "METHODIDENTIFIERS": {
                  title:    "Payment Method Identifiers"
              ,   href:     "method-identifiers.html"
              ,   authors:  [
                      "Adrian Bateman"
                  ,   "Zach Koch"
                  ,   "Richard Barnes"
                  ]
              ,   status:   "ED"
              },
              "WEBIDL": {
                  title:    "WebIDL Level 1"
              ,   href:     "http://www.w3.org/TR/WebIDL-1/ "
              ,   authors:  [
                      "Cameron McCormack"
                  ,   "Boris Zbarsky"
                  ]
              ,   status:   "CR"
              }
          }
      };
    </script>
    <style>
    dt { margin-top: 0.75em; }
    table { margin-top: 0.75em; border-collapse:collapse; border-style:hidden hidden none hidden }
    table thead { border-bottom:solid }
    table tbody th:first-child { border-left:solid }
    table td, table th { border-left:solid; border-right:solid; border-bottom:solid thin; vertical-align:top; padding:0.2em }
    li { margin-top: 0.5em; margin-bottom: 0.5em;}
    </style>
  </head>
  <body>
    <section id='abstract'>
      <p>
				The SEPA Credit Transfer specification describes the data formats used by the PaymentRequest API [[!PAYMENTREQUESTAPI]] to support payment by SEPA Credit Transfers 
      </p>
    </section>

    <section id='sotd'>
      <p>
        The working group maintains <a href="https://github.com/w3c/browser-payment-api/issues">a
        list of all bug reports that the group has not yet addressed</a>.
      </p>
    </section>
    
    <section class='informative'>
      <h2>Introduction</h2>
      <p>
				This specification is a Payment Transaction Message Specification used by the PaymentRequest API [[!PAYMENTREQUESTAPI]] to support Credit Transfer and Direct Debits. It is intended to provide compatibility for merchants who currently request account details from customers to ease adoption of the PaymentRequest API.</p>
      <p>In the future, merchants may favor payment methods that provide a tokenized response rather than clear text details.</p>
    </section>

    <section id="dependencies"> 
      <h2>Dependencies</h2> 
      <p> 
      This specification relies on several other underlying specifications. 
      </p> 
      <dl> 
        <dt>Payment Request Architecture</dt>
        <dd>The terms <dfn data-lt="payment method|payment methods">Payment Method</dfn>,
        <dfn data-lt="payment app|payment apps">Payment App</dfn>, and <dfn>Payment Transaction
        Message Specification</dfn> are defined by the Payment Request Architecture document
        [[!PAYMENTARCH]].</dd>
        <dt>Payment Request API</dt>
        <dd>The term <dfn>PaymentRequest constructor</dfn> is defined by the PaymentRequest API
        specification [[!PAYMENTREQUESTAPI]].</dd>
        <dt>Payment Method Identifiers</dt>
        <dd>The term <dfn data-lt="payment method identifier|payment method identifiers">Payment
        Method Identifier</dfn> is defined by the Payment Method Identifiers specification
        [[!METHODIDENTIFIERS]].</dd>
        <dt>Web IDL</dt>
        <dd>The IDL in this specification is defined by Web IDL [[!WEBIDL]].</dd>
      </dl>
    </section>

    <section id="method-id">
      <h2>Payment Method Identifier</h2>
      <p>The following payment method identifier strings are supported by the Basic CT-DD Payment data formats.</p>

      <table>
        <tr><th>Identifier String</th><th>Description</th><th>Comment</th></tr>

				<tr>
					<td>PushSCT</td>
					<td>Payment Application Executed SEPA Credit Transfer</td>
					<td>This scenario is where the Credit Transfer in initiaited by the Payment Application.</td>
				</tr>
				
				<tr>
					<td>PullSCT</td>
					<td>Payee Merchant Executed SEPA Credit Transfer</td>
					<td>This scenario is where the Credit Transfer in initiaited by the Payee or their PSP. TO BE DEFINED, AWAITING PSD2 INTRODUCTION</td>
				</tr>
	
      </table>
    </section>

    <section id="flow">
    
      <h2>Payment Method Flow</h2>
      <p>The following represent the flow for the supported <a>payment method identifier</a> strings as they could be used by a website</p>
      <p>The blue call-outs show where and how the API is invoked.</p>
				
			<section>
				<h3>Consumer Initiated SEPA Credit Transfer</h3>
				<div><a href="http://www.plantuml.com/plantuml/proxy?fmt=svg&src=https://raw.githubusercontent.com/w3c/webpayments-methods-credit-transfer-direct-debit/gh-pages/SCT.pml"><img width="100%" src="http://www.plantuml.com/plantuml/proxy?fmt=svg&src=https://raw.githubusercontent.com/w3c/webpayments-methods-credit-transfer-direct-debit/gh-pages/SCT.pml"/></a></div>


				<div class="issue" title="Flow update required">
				Update to match field exchanges
				</div>	
				
			</section>
						
    </section>
	
		<section id="init-data">
			<h2>Payment Method Specific Data for the PaymentRequest constructor</h2>
			<p>This section describes payment method specific data that is supplied as part of the <code>data</code>
				argument to the PaymentRequest constructor.</p>

			<div class="issue" title="Sub-class modelling required?">
			The below credit transfer and direct debit types need some consideration for modelling via an inheritance/subclass relationships
			</div>	
			
			<section>		
				<h2>PullSCTRequest</h2>
				<p>The <dfn><code>PullSCTRequest</code></dfn> dictionary contains the request from the
					PaymentRequest API when a user accepts payment with a SEPA Credit Transfer payment method.</p>
			
				<p>The fields are based upon the Customer to Bank Credit Transfer Initiation (DS-01) specification from <a href="http://www.europeanpaymentscouncil.eu/index.cfm/knowledge-bank/epc-documents/sepa-credit-transfer-rulebook-version-81/">SEPA Credit Transfer Rulebook Version 8.1</a></p>
				<p>However the field names are amended to follow closely with roles defined in the W3C WebPayment specification. Mappings are provided in the field descriptions.</p>
					
				<div class="issue" title="Mapping information to be added?">
				Add information from SEPA Rule Book mapping from analysis spreadsheet
				</div>	
				
				<div class="issue" title="Other references useful?">
				We have reference the SEPA Rule Book, is ISO20022 PAIN 001.006 (or 003) message useful here?
				</div>	
					
				<pre class="idl">
					dictionary PullSCTRequest {
									sequence<DOMString> requiredFields;
										
						required	DOMString PayeeIBAN;
									DOMString PayeeName;
									DOMString PayeeIdentificationCode;

						required	DOMString PayeePaymentIdentification;
						
									DOMString SellerName;
									DOMString SellerIdentificationCode;

						required	DOMString PurposeCode;
									DOMString CategoryPurposeCode;
								 
									DOMString PreferredProcessingDate;
									DOMString NotificationURL;
					};
				 </pre>
			</section>
	
			<section>
				<h2>Request Fields</h2>
				<p>The dictionaries contains the following fields:</p>

				<dl>
					<dt><dfn><code>requiredFields</code></dfn></dt>
					<dd>The <code>requiredFields</code> field contains the list of fields that the Payment App must attempt to return, if this requirements cannot be met, e.g. the payment instrument must fail as this is a push payment.</dd>

					<div class="issue" title="Sub-class modelling required?">
					The above field is also required in the BasicCardRequest, does this need modelling in the a superclass or base api?
					</div>	
					
					<div class="issue" title="Failed payment edge cases?">
					The above field is required, but this can result in failed payments after 'Authorise' clicked. Should we have a better modelling (e.g. using subclasses) to allow for a more fine grained matching of apps to requests? Does the PMI specification need to support this?
					</div>	
					
					<dt><dfn><code>PayeeIBAN</code></dfn></dt>
					<dd>The <code>PayeeIBAN</code> field contains the International Bank Identification Number of the Payee</dd>

					<dt><dfn><code>PayeeName</code></dfn></dt>
					<dd>The <code>PayeeName</code> Name of the Payee. First name, Last name or, for a company the legal name.</dd>

					<dt><dfn><code>SellerName</code></dfn></dt>
					<dd>The <code>SellerName</code> Name of the Payee. First name, Last name or, for a company the legal name.</dd>
					
					<dt><dfn><code>PayeePaymentIdentitication</code></dfn></dt>
					<dd>The <code>PayeePaymentIdentification</code> field contains a payee identification which will be used for reconciliation</dd>

					<dt><dfn><code>PurposeCode</code></dfn></dt>
					<dd>The <code>PurposeCode</code> ISO20022 Purpose Code from <a href="https://www.iso20022.org/documents/External_code_lists/ExternalCodeSets_1Q2016_11May2016_v1.xls">ISO20022 External Code Sets</a></dd>

					<dt><dfn><code>CategoryPurposeCode</code></dfn></dt>
					<dd>The <code>CategoryPurposeCode</code> ISO20022 Category Purpose code from <a href="https://www.iso20022.org/documents/External_code_lists/ExternalCodeSets_1Q2016_11May2016_v1.xls">ISO20022 External Code Sets</a>, defaults to EPAY (ePayment) if excluded</dd>

					<dt><dfn><code>PreferredProcessingDate</code></dfn></dt>
					<dd>The <code>PreferredProcessingDate</code> merchants preferred processing date</dd>

					<div class="issue" title="Field date type">
					The above field needs changing to a date type
					</div>
					
					<dt><dfn><code>NotificationURL</code></dfn></dt>
					<dd>The <code>NotificationURL</code> is the endpoint (a.k.a. webhook) that will be called by the payment app to update the merchant. This can be used to protect against various failure scenarios.</dd>			

					<div class="issue" title="Message authentication">
					We need to investigate a means for message authentication on the above call-back. If this field is commonyl used, e.g. AliPay also, there is a case for specifying this in a superclass or other spec
					</div>
					
					<div class="issue" title="Field lengths">
					The field types need specifying for the above fields and also the max lengths for strings
					</div>
					
				</dl>
			
			</section>
		</section>
	
		<section id="response">
			<h2>Payment Method Response</h2>
			<p>The <dfn><code>PullSCTResponse</code></dfn> dictionary contains the response from the
			PaymentRequest API when a user accepts payment with a Basic Payment CT-DD payment method.</p>

			<p>This section describes payment method specific data that is supplied as part of the response
				from PaymentRequest.</p>
				
			<section>
	
				<h2>PullSCTResponse</h2>
				<p>The SCTExecutionResponse message means that message has been submitted to the Consumer Bank, not that funds transfer has occured.
				The merchant should wait for notification from its Bank that the payment has cleared.</p>
		
				<pre class="idl"> 
					dictionary PullSCTResponse {
						required	DOMString		SelectedProcessingDate;
						required	DOMString		PayerPaymentIdentification;
									DOMString		BuyerIdentificationCode;
									DOMString		PayerIdentificationCode;
					};
				</pre>
				
			</section>
	
			<section>
				<h2>Response Fields</h2>
				<p>The dictionaries contains the following fields:</p>
				<p>
					The <code>BasicCTDDResponse</code> dictionary contains the following fields:
				</p>

				<dl>
					<dt><dfn><code>SelectedPaymentDate</code></dfn></dt>
					<dd>The date that the payment was requested to be initiated, this may be today, tomorrow or in principle sometime in the future if the consumer wishes to defer payment.</dd>
					<dt><dfn><code>PayerPaymentIdentification</code></dfn></dt>
					<dd>The reference supplied by the Payer (End to End Identification in ISO20022 definition)</dd>
					
					<div class="issue" title="Field date type">
					The above field needs changing to a date type
					</div>
									
					<dt><dfn><code>PayerdentificationCode</code></dfn></dt>
					<dd>The payer reference</dd>
					<dt><dfn><code>BuyerIdentificationCode</code></dfn></dt>
					<dd>The buyer reference. The buyer may be a 3rd party to the payer. If the payer is paying on behalf of another party.</dd>

					<div class="issue" title="Privacy issues?">
					The above two fields return information about the payer and buyer, what privacy implications are there for this?
					</div>
				</dl>

			</section>
			
		</section>
		
    </section>

  </body>
</html>
