<!DOCTYPE html>
<html>
  <head>
    <title>Basic Credit Transfer Payment</title>
    <meta charset='utf-8'>
    <script src='https://www.w3.org/Tools/respec/respec-w3c-common'
            async class='remove'></script>
    <script class='remove'>
      var respecConfig = {
          shortName:  "webpayments-methods-credit-transfer",
          edDraftURI:   "http://w3c.github.io/webpayments-methods-credit-transfer-direct-debit/",
          specStatus: "ED",
          editors: [
                {   name:       "Cyril Vignet",
                    company:    "BPCE" },
				{   name:       "Matt Saxon",
                    company:    "Worldpay" }
          ],
          useExperimentalStyles: true,
          license:      "w3c-software-doc",
          //previousMaturity: "FPWD",
          //previousPublishDate:  "1977-03-15",
          wg:           "Web Payments Working Group",
          wgURI:        "https://www.w3.org/Payments/WG/",
          wgPublicList: "public-payments-wg",
          wgPatentURI:  "https://www.w3.org/2004/01/pp-impl/83744/status",
          issueBase:    "https://github.com/w3c/webpayments-methods-credit-transfer-direct-debit/issues",
          localBiblio:  {
              "PAYMENTREQUESTAPI": {
                  title:    "Payment Request API"
              ,   href:     "paymentrequest.html"
              ,   authors:  [
                      "Adrian Bateman"
                  ,   "Zach Koch"
                  ,   "Roy McElmurry"
                  ,   "Marcos Caceres"
                  ]
              ,   status:   "WD"
              },
              "METHODIDENTIFIERS": {
                  title:    "Payment Method Identifiers"
              ,   href:     "method-identifiers.html"
              ,   authors:  [
                      "Adrian Bateman"
                  ,   "Zach Koch"
                  ,   "Roy McElmurry"
                  ,   "Marcos Caceres"
                  ]
              ,   status:   "WD"
              },
              "WEBIDL": {
                  title:    "WebIDL Level 1"
              ,   href:     "http://www.w3.org/TR/WebIDL-1/ "
              ,   authors:  [
                      "Cameron McCormack"
                  ,   "Boris Zbarsky"
                  ]
              ,   status:   "CR"
              },
              "ISO3166-2": {
                  title:    "ISO 3166-2"
              ,   href:     "http://www.iso.org/iso/home/standards/country_codes.htm"
              }
          }
      };
    </script>
    <style>
    dt { margin-top: 0.75em; }
    table { margin-top: 0.75em; border-collapse:collapse; border-style:hidden hidden none hidden }
    table thead { border-bottom:solid }
    table tbody th:first-child { border-left:solid }
    table td, table th { border-left:solid; border-right:solid; border-bottom:solid thin; vertical-align:top; padding:0.2em }
    li { margin-top: 0.5em; margin-bottom: 0.5em;}
    </style>
  </head>
  <body>
    <section id='abstract'>
      <p> This specification is a Payment Method specification for use with the PaymentRequest API [PAYMENT-REQUEST-API]. With it, merchants and payers can exchange information required for credit transfers across a variety of payment systems.
      </p>
    </section>

    <section id='sotd'>
      <p>
        The working group maintains <a href="https://github.com/w3c/webpayments-methods-credit-transfer-direct-debit/issues">a
        list of all bug reports that the group has not yet addressed</a>.
      </p>
    </section>
    
    <section class='informative'>
      <h2>Introduction</h2>
      <p>This specification is a Payment Transaction Message Specification used by the PaymentRequest API [[!PAYMENTREQUESTAPI]] to support SEPA complaint Credit Transfers.</p>

    </section>

    <section id="dependencies"> 
      <h2>Dependencies</h2> 
      <p> 
      This specification relies on several other underlying specifications. 
      </p> 
      <dl> 
        <dt>Payment Request API</dt>
        <dd>The term <dfn>PaymentRequest constructor</dfn> is defined by the PaymentRequest API
        specification [[!PAYMENTREQUESTAPI]].</dd>
        <dt>Payment Method Identifiers</dt>
        <dd>The term <dfn data-lt="payment method identifier|payment method identifiers">Payment
        Method Identifier</dfn> is defined by the Payment Method Identifiers specification
        [[!METHODIDENTIFIERS]].</dd>
        <dt>Web IDL</dt>
        <dd>The IDL in this specification is defined by Web IDL [[!WEBIDL]].</dd>
	<dt>ISO 3611</dt>
	<dd>Country codes defined in [[!ISO3166-2]] are used by merchants as a filter for indicating the countries from which they accept credit transfers.</dd>
      </dl>
    </section>

    <section id="method-id">
      <h2>Payment Method Identifier</h2>
      <p>The <a>payment method identifier</a> string for the Basic Credit Transfer Payment method is <dfn><code>credit-transfer</code></dfn>.</p>
    </section>
    
    <section id="request">
      <h2>Payment Method Specific Data for the PaymentRequest constructor</h2>
      <p>This section describes payment method specific data that is supplied as part of the <code>data</code> argument to the PaymentRequest constructor.</p>
      
      <section>		
	<h2>CreditTransferRequest</h2>

	<div class="note">The current fields are based upon the Customer to Bank Credit Transfer Initiation (DS-01) specification from <a href="http://www.europeanpaymentscouncil.eu/index.cfm/knowledge-bank/epc-documents/sepa-credit-transfer-rulebook-version-81/">SEPA Credit Transfer Rulebook Version 8.1</a>. However the field names are amended to follow with roles defined in the W3C WebPayment specification. Mappings are provided in the field descriptions and are prefixed AT-xx. The Editors are also considering moving in the direction of terms used in the <a href="https://www.swift.com/standards/market-practice/common-global-implementation">Common Global Implementation (CGI)</a>.</div>

	<pre class="idl">
	  dictionary CreditTransferRequest {
	  sequence&lt;DOMString&gt; requiredResponseFields;
	  sequence&lt;DOMString&gt; supportedCountries;
	    
          required DOMString payeeIBAN;
	  DOMString payeeName;
	  DOMString payeeIdentificationCode;
	    
	  required DOMString payeePaymentIdentification;
	  DOMString sellerName;
	  DOMString sellerIdentificationCode;
	    
	  required DOMString purposeCode;
	  DOMString categoryPurposeCode;
	    
	  DOMString preferredProcessingDate;
	  DOMString notificationURL;
	  };
	</pre>

	<p>The <code>CreditTransferRequest</code> dictionary contains the following fields:</p>
	
	<dl>
	  <dt><dfn><code>requiredResponseFields</code></dfn></dt>
	  <dd>Contains the list of fields that the Payment App must attempt to return, if this requirements cannot be met, e.g. the payment instrument must fail as this is a push payment.
	  
	  <div class="issue" title="Sub-class modelling required?">
	    The above field is also required in the BasicCardRequest, does this need modelling in the a superclass or base api?
	  </div>	
	  
	  <div class="issue" title="Failed payment edge cases?">
	    The above field is required, but this can result in failed payments after 'Authorise' clicked. Should we have a better modelling (e.g. using subclasses) to allow for a more fine grained matching of apps to requests? Does the PMI specification need to support this?
	  </div>
	  </dd>
	  <dt><dfn><code>supportedCountries</code><dfn></dt>
	  <dd>The supportedNetworks field contains a sequence of [[!ISO3166-2]] identifiers of countries from which the merchant accepts credit transfers. This value is optional. If a value is not provided then the merchant accepts credit transfers from any country. 
	  </dd>
	  <dt><dfn><code>payeeIBAN</code></dfn></dt>
	  <dd>AT-20: The IBAN of the account of the Beneficiary</dd>
	  <dd>The International Bank Account Number used to uniquely identify the account of a customer at a financial institution.</dd>
	  
	  <dt><dfn><code>payeeName</code></dfn></dt>
	  <dd>AT-21 The name of the Beneficiary</dd>
	  <dd>The name of the Beneficiary as supplied by the Originator</dd>
	  
	  <dt><dfn><code>payeeIdentificationCode</code></dfn></dt>
	  <dd>AT-24: The Beneficiary identification code</dd>
	  <dd>A code supplied by the Originator</dd>
	  
	  <dt><dfn><code>payeePaymentIdentification</code></dfn></dt>
	  <dd>AT-05: The Remittance Information sent by the Originator to the Beneficiary in the Credit Transfer Instruction</dd>
	  <dd>A maximum of 140 characters for unstructured Remittance Information (see SEPA Rulebook for details for standard structure)</dd>
	  
	  <dt><dfn><code>sellerName</code></dfn></dt>
	  <dd>AT-28: The name of the Beneficiary Reference Party</dd>
	  <dd>The name of a person in relation to whom a Beneficiary receives a payment</dd>
	  <dd>The Beneficiary Reference Party is a person on behalf of or in connection with whom the Beneficiary
	    receives a payment.</dd>
	  <dd>Reference in any payment instruction to a Beneficiary Reference Party does not imply that such party
	    is a Beneficiary or otherwise a payee, or is contractually obliged or entitled in connection with any
	    payment obligation</dd>
	  
	  <dt><dfn><code>sellerIdentificationCode</code></dfn></dt>
	  <dd>AT-29: The identification code of the Beneficiary Reference Party</dd>
	  <dd>A code supplied by the Originator and to be delivered unaltered to the Beneficiary</dd>						
	  
	  <dt><dfn><code>purposeCode</code></dfn></dt>
	  <dd>AT-44: The purpose of the credit transfer</dd>
	  <dd>The purpose of the credit transfer is the underlying reason for the credit transfer transaction, i.e.
	    information on the nature of such transaction.</dd>
	  <dd>All codes part of the ISO standard are accepted
	    <a href="https://www.iso20022.org/documents/External_code_lists/ExternalCodeSets_1Q2016_11May2016_v1.xls">ISO20022 External Code Sets</a>
	    Purpose
	  </dd>
	  
	  <dt><dfn><code>categoryPurposeCode</code></dfn></dt>
	  <dd>AT-45: The category purpose of the credit transfer</dd>
	  <dd>The category purpose of the credit transfer is information on the high level nature of the credit transfer
	    transaction. It can have different goals: allow the Originator Bank to offer a specific processing agreed
	    with the Originator, or allow the Beneficiary Bank to apply a specific processing
	  <dd>All codes part of the ISO standard are accepted from
	    <a href="https://www.iso20022.org/documents/External_code_lists/ExternalCodeSets_1Q2016_11May2016_v1.xls">ISO20022 External Code Sets</a>, defaults to EPAY (ePayment) if excluded
	    CategoryPurpose
	  </dd>
	  
	  <dt><dfn><code>preferredProcessingDate</code></dfn></dt>
	  <dd>The merchants preferred processing date, see field SelectedProcessingDate in <dfn><code>CreditTransferResponse</code></dfn></dd>
	  
	  <div class="issue" title="Field date type">
	    The formatting of the date needs specifying
	  </div>
	  
	  <dt><dfn><code>notificationURL</code></dfn></dt>
	  <dd>The endpoint (a.k.a. webhook) that will be called by the payment app to update the merchant. This can be used to protect against various failure scenarios.</dd>
	  <dd>The <dfn><code>CreditTransferResponse</dfn></code> will be posted to the notificationURL serialised as application/JSON</dd>
	  
	  <div class="issue" title="Message authentication">
	    We need to investigate a means for message authentication on the above call-back. If this field is commonyl used, e.g. AliPay also, there is a case for specifying this in a superclass or other spec
	  </div>
	  
	  <div class="issue" title="Field lengths">
	    Are there any further maximum field lengths that need specifying?
	  </div>
	  
	</dl>
	
      </section>
    </section>
    
    <section id="response">
      <h2>Payment Method Response</h2>

      <p>The <dfn><code>CreditTransferResponse</code></dfn> dictionary
	contains the response from the PaymentRequest API when a user accepts payment with a Basic Credit Transfer payment method.</p>
      
      <section>
	
	<h2>CreditTransferResponse</h2>
	<p>The <dfn><code>CreditTransferResponse</dfn></code> message means that a message has been submitted to the Payee's Bank, not that funds transfer has occured. The merchant should wait for notification from its Bank that the payment has cleared.</p>
	
	<pre class="idl"> 
	  dictionary CreditTransferResponse {
	  required	DOMString selectedProcessingDate;
	  required	DOMString payerPaymentIdentification;
	  DOMString     payerIdentificationCode;
	  DOMString     buyerIdentificationCode;
	  };
	</pre>
	
	<p>The <dfn><code>CreditTransferResponse</code></dfn> dictionary contains the following fields:</p>
	
	<dl>
	  <dt><dfn><code>selectedProcessingDate</code></dfn></dt>
	  <dd>This date may be different from that requested by the Payee, either because of a business rule (e.g., non business day, or a preference from the payee to defer payment</dd>
	  <dd>AT-07: The Requested Execution Date of the instruction</dd>
	  <dd>This date corresponds with a date requested by an Originator for commencing the execution of the
	    Credit Transfer Instruction as described in section 4.2.1.</dd>
	  
	  <div class="issue" title="Field date type">
	    The formatting of the date needs specifying
	  </div>
	  
	  <dt><dfn><code>payerPaymentIdentification</code></dfn></dt>
	  <dd>The reference supplied by the Payer (End to End Identification in ISO20022 definition)</dd>
	  <dd>AT-41: The Originator’s reference of the Credit Transfer Transaction</dd>
	  <dd>This reference identifies for a given Originator each Credit Transfer Transaction presented to the
	    Originator Bank, in a unique way. This number will be transmitted in the entire process of the handling
	    of the credit transfer transactions from acceptance until the finality of the transaction. It must be
	    returned in any exception handling process-step by any party involved. The Originator cannot request
	    for any other referencing information to be returned to him, in order to identify a credit transfer. The
	    Originator must define the internal structure of this reference; it can only be expected to be meaningful
	    to the Originator</dd>
	  
	  <dt><dfn><code>payerIdentificationCode</code></dfn></dt>
	  <dd>AT-10: The Originator identification code</dd>
	  <dd>A code supplied by the Originator and to be delivered unaltered to the Beneficiary</dd>
	  
	  <dt><dfn><code>buyerIdentificationCode</code></dfn></dt>
	  <dd>The buyer reference. The buyer may be a 3rd party to the payer. If the payer is paying on behalf of another party.</dd>
	  <dd>AT-09: The identification code of the Originator Reference Party</dd>
	  <dd>A code supplied by the Originator and to be delivered unaltered to the Beneficiary</dd>
	  
	  <div class="issue" title="Privacy issues?">
	    The above two fields return information about the payer and buyer, are there any privacy implications for these?
	  </div>
	</dl>
	
      </section>
    </section>

    <section id="design-considerations">
      <h2>Appendix: Design Considerations</h2>
      <p>The following are design considerations for this specification.</p>
      <ul>
	<li>The specification should work for multiple credit transfer
	  systems. In the WPWG we identified systems such as ACH,
	  SEPA, BACS, and CHAPS, but that list is neither exhaustive
	  nor definitive.</li>
	<li>When faced with a design choice, prefer the option that
	  favors low-value payments over high-value payments.</li>
      </ul>
    </section>

    <section id="flow">
      <h2>Appendix: Credit Transfer Flow Illustration</h2>
      <p>This diagram illustrates the credit transfer flow, using a SEPA credit transfer as an example.</p>
      
      <div><a href="http://www.plantuml.com/plantuml/proxy?fmt=svg&src=https://raw.githubusercontent.com/w3c/webpayments-methods-credit-transfer-direct-debit/gh-pages/SCT.pml"><img width="100%" src="http://www.plantuml.com/plantuml/proxy?fmt=svg&src=https://raw.githubusercontent.com/w3c/webpayments-methods-credit-transfer-direct-debit/gh-pages/SCT.pml"/></a></div>				
      
    </section>
    
    <section id="acks">
      <h2>Acknowledgments</h2>
      <p>Laurent Castillo (Gemalto), Kris Ketels (Swift), Vincent Kuntz (Swift), Frédéric Meignien (Canton Consulting).</p>
    </section>
  </body>
</html>
